{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.9.2", "generated_at": "2025-03-24T11:25:17.537449Z", "invocation_id": "446d58c4-7178-4d78-bbae-594a47329c01", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-24T11:25:12.529466Z", "completed_at": "2025-03-24T11:25:12.549069Z"}, {"name": "execute", "started_at": "2025-03-24T11:25:12.549799Z", "completed_at": "2025-03-24T11:25:17.496540Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 4.9693028926849365, "adapter_response": {"_message": "CREATE TABLE (40.0 rows, 466.1 KiB processed)", "code": "CREATE TABLE", "rows_affected": 40, "bytes_processed": 477300, "bytes_billed": 52428800, "location": "US", "project_id": "gerolingcp", "job_id": "9a3f6b51-f9a0-41e3-91bb-08758c5afce1", "slot_ms": 238224}, "message": "CREATE TABLE (40.0 rows, 466.1 KiB processed)", "failures": null, "unique_id": "model.fiosiovet.resultado_operacional", "compiled": true, "compiled_code": "\nWITH Receita AS \n(\n  SELECT\n    FORMAT_DATE('%Y-%m-01', date) AS Mes,\n    SE.Local,\n    ROUND(SUM(CAST(Liquido AS FLOAT64)),2) AS ValorTotal,\n    COUNT(1) AS Atendimentos\n  FROM `gerolingcp.FisioVet.sales` SA\n  JOIN `gerolingcp.FisioVet.services` SE\n    ON SA.ProdutoServico = SE.Servico\n  GROUP BY\n    FORMAT_DATE('%Y-%m-01', date),\n    SE.Local\n),\nCustoFixo AS\n(\n  SELECT \n    FORMAT_DATE('%Y-%m-01', date) AS Mes,\n    DT.Local,\n    ROUND(SUM(CAST(ValorPago AS FLOAT64)),2) AS TotalPago\n  FROM `gerolingcp`.`FisioVet`.`debts`  D\n  JOIN `gerolingcp.FisioVet.debts_types` DT\n    ON D.Categoria = DT.CategoriaDebito\n  WHERE DT.Tipo = 'Fixo'\n  GROUP BY \n    FORMAT_DATE('%Y-%m-01', date),\n    Local\n)\n,CustoVariavel AS\n(\n  SELECT \n    FORMAT_DATE('%Y-%m-01', date) AS Mes,\n    DT.Local,\n    ROUND(SUM(CAST(D.ValorPago AS FLOAT64)),2) AS TotalPago\n  FROM `gerolingcp`.`FisioVet`.`debts`  D\n  JOIN `gerolingcp.FisioVet.debts_types` DT\n    ON D.Categoria = DT.CategoriaDebito\n  WHERE DT.Tipo = 'Vari\u00e1vel'\n  GROUP BY \n    FORMAT_DATE('%Y-%m-01', date),\n    DT.Local\n)\n,Comissoes AS\n(\n  SELECT\n    FORMAT_DATE('%Y-%m-01', date) AS Mes,\n    SE.Local,\n    ROUND(SUM((CAST(S.Liquido AS FLOAT64)*(C.Comissao/100))),2) AS Comissao\n  FROM `gerolingcp`.`FisioVet`.`sales`  S\n  JOIN `FisioVet.commission` C\n    ON S.Funcionario = C.Funcionario\n    AND S.ProdutoServico = C.ProdutoServico\n  JOIN `FisioVet.services` SE\n    ON S.ProdutoServico = SE.Servico\n  GROUP BY\n    FORMAT_DATE('%Y-%m-01', date),\n    SE.Local\n)\nSELECT \n  R.Mes, \n  R.Local,\n  R.Atendimentos,\n  R.ValorTotal AS Receita,\n  ROUND(\n    (R.ValorTotal / R.Atendimentos)\n  ,2) AS TicketMedio,\n  IFNULL(CF.TotalPago,0) AS CustoFixo,\n  ROUND(\n    (IFNULL(CF.TotalPago,0) / R.Atendimentos)\n  ,2) AS CustoFixoPorAtendimento,\n  ROUND(\n    (R.ValorTotal - IFNULL(CF.TotalPago,0))\n  ,2) AS LucroBruto, \n  IFNULL(CV.TotalPago,0) AS CustoVariavel,\n  ROUND(\n    (IFNULL(CV.TotalPago,0) / R.Atendimentos)\n  ,2) AS CustoVariavelPorAtendimento,\n  IFNULL(CC.Comissao,0) AS CustoComissoes,\n  ROUND(\n    (IFNULL(CC.Comissao,0) / R.Atendimentos)\n  ,2) AS CustoComissoesPorAtendimento,\n  ROUND(\n    (IFNULL(CC.Comissao,0) / R.ValorTotal )  * 100\n  ,2) AS PorcentagemMediaComissoes,\n  ROUND(\n    (R.ValorTotal - IFNULL(CF.TotalPago,0) - IFNULL(CV.TotalPago,0) - IFNULL(CC.Comissao,0)\n  ),2) AS LucroLiquido,\n  ROUND(\n    ((R.ValorTotal - IFNULL(CF.TotalPago,0) - IFNULL(CV.TotalPago,0) - IFNULL(CC.Comissao,0)) / R.Atendimentos)\n  ,2) AS LucroLiquidoPorAtendimento\nFROM Receita R\nLEFT JOIN CustoFixo CF\n  ON R.Mes = CF.Mes\n  AND R.Local = CF.Local\nLEFT JOIN CustoVariavel CV\n  ON R.Mes = CV.Mes\n  AND R.Local = CV.Local\nLEFT JOIN Comissoes CC\n  ON R.Mes = CC.Mes\n  AND R.Local = CC.Local", "relation_name": "`gerolingcp`.`FisioVet_Analytics`.`resultado_operacional`", "batch_results": null}], "elapsed_time": 7.348813056945801, "args": {"which": "run", "cache_selected_only": false, "select": ["resultado_operacional"], "log_level_file": "debug", "warn_error_options": {"include": [], "exclude": []}, "exclude": [], "static_parser": true, "require_resource_names_without_spaces": false, "project_dir": "/opt/airflow/dags/FisioVet/.dbt", "macro_debugging": false, "send_anonymous_usage_stats": true, "log_level": "info", "require_yaml_configuration_for_mf_time_spines": false, "source_freshness_run_project_hooks": false, "state_modified_compare_more_unrendered_values": false, "quiet": false, "require_explicit_package_overrides_for_builtin_materializations": true, "printer_width": 80, "indirect_selection": "eager", "show_resource_report": false, "strict_mode": false, "log_format": "default", "invocation_command": "dbt run -m resultado_operacional --profiles-dir /opt/airflow/dags/FisioVet/.dbt --project-dir /opt/airflow/dags/FisioVet/.dbt", "state_modified_compare_vars": false, "empty": false, "require_nested_cumulative_type_params": false, "populate_cache": true, "print": true, "require_batched_execution_for_custom_microbatch_strategy": false, "favor_state": false, "log_path": "/opt/airflow/dags/FisioVet/.dbt/logs", "profiles_dir": "/opt/airflow/dags/FisioVet/.dbt", "version_check": true, "use_colors_file": true, "vars": {}, "defer": false, "log_file_max_bytes": 10485760, "skip_nodes_if_on_run_start_fails": false, "write_json": true, "introspect": true, "partial_parse": true, "partial_parse_file_diff": true, "log_format_file": "debug", "use_colors": true}}